<!DOCTYPE html><html><head><title>iOS:获取存储空间及占用空间</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style>
.note-content  {font-family: 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif;}

</style></head><body><div id='preview-contents' class='note-content'>
                        
                    



<h1 id="ios获取存储空间及占用空间">iOS:获取存储空间及占用空间</h1>

<p>获得单个文件的大小</p>

<pre class="prettyprint hljs-dark"><code class="language-objectivec hljs"><span class="hljs-comment">/**<br> 获得单个文件的大小<br><br> @param filePath 文件路径<br> @return 单位(字节)<br> */</span><br>- (<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>) fileSizeAtPath:(<span class="hljs-built_in">NSString</span>*) filePath{<br>    <span class="hljs-built_in">NSFileManager</span>* manager = [<span class="hljs-built_in">NSFileManager</span> defaultManager];<br>    <span class="hljs-keyword">if</span> ([manager fileExistsAtPath:filePath]){<br>        <span class="hljs-keyword">return</span> [[manager attributesOfItemAtPath:filePath error:<span class="hljs-literal">nil</span>] fileSize];<br>    }<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><br> 获得文件夹（遍历）的大小<br><span class="hljs-comment">/**<br> 获得文件夹（遍历）的大小<br> @param folderPath 文件夹路径<br> @return 单位(M)<br> */</span><br>- (<span class="hljs-keyword">float</span> ) folderSizeAtPath:(<span class="hljs-built_in">NSString</span>*) folderPath{<br>    <span class="hljs-built_in">NSFileManager</span>* manager = [<span class="hljs-built_in">NSFileManager</span> defaultManager];<br>    <span class="hljs-keyword">if</span> (![manager fileExistsAtPath:folderPath]) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">NSEnumerator</span> *childFilesEnumerator = [[manager subpathsAtPath:folderPath] objectEnumerator];<br>    <span class="hljs-built_in">NSString</span>* fileName;<br>    <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> folderSize = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> ((fileName = [childFilesEnumerator nextObject]) != <span class="hljs-literal">nil</span>){<br>        <span class="hljs-built_in">NSString</span>* fileAbsolutePath = [folderPath stringByAppendingPathComponent:fileName];<br>        folderSize += [<span class="hljs-keyword">self</span> fileSizeAtPath:fileAbsolutePath];<br>    }<br>    <span class="hljs-keyword">return</span> folderSize/(<span class="hljs-number">1024.0</span>*<span class="hljs-number">1024.0</span>);<br>}<br></code></pre>

<p>根据上面的<code>获得文件夹（遍历）的大小</code>的方法, 可获取当前应用占用空间</p>



<pre class="prettyprint hljs-dark"><code class="language-objectivec hljs">    <span class="hljs-comment">//获取当前应用的目录</span><br>    <span class="hljs-built_in">NSString</span> *destPath = <span class="hljs-built_in">NSHomeDirectory</span>();<br>    <span class="hljs-comment">//计算目录占用的控件</span><br>    <span class="hljs-built_in">CGFloat</span> AppFolderSize = [<span class="hljs-keyword">self</span> folderSizeAtPath:destPath];<br></code></pre>

<p>获取本地全部空间(去除系统占用大小)&amp;剩余空间</p>

<pre class="prettyprint hljs-dark"><code class="language-objectivec hljs"><span class="hljs-comment">/**<br> 获取硬盘空间及剩余可用空间<br> */</span><br>-(<span class="hljs-keyword">void</span>)getFreeDiskspace {<br>    <span class="hljs-keyword">float</span> totalSpace;<br>    <span class="hljs-keyword">float</span> totalFreeSpace;<br>    <span class="hljs-built_in">NSError</span> *error = <span class="hljs-literal">nil</span>;<br>    <span class="hljs-built_in">NSArray</span> *paths = <span class="hljs-built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="hljs-built_in">NSDocumentDirectory</span>, <span class="hljs-built_in">NSUserDomainMask</span>, <span class="hljs-literal">YES</span>);<br>    <span class="hljs-built_in">NSDictionary</span> *dictionary = [[<span class="hljs-built_in">NSFileManager</span> defaultManager] attributesOfFileSystemForPath:[paths lastObject] error: &amp;error];<br><br>    <span class="hljs-keyword">if</span> (dictionary) {<br>        <span class="hljs-built_in">NSNumber</span> *fileSystemSizeInBytes = [dictionary objectForKey: <span class="hljs-built_in">NSFileSystemSize</span>];<br>        <span class="hljs-built_in">NSNumber</span> *freeFileSystemSizeInBytes = [dictionary objectForKey:<span class="hljs-built_in">NSFileSystemFreeSize</span>];<br>        totalSpace = [fileSystemSizeInBytes floatValue]/<span class="hljs-number">1024.0</span>f/<span class="hljs-number">1024.0</span>f/<span class="hljs-number">1024.0</span>f;<br>        totalFreeSpace = [freeFileSystemSizeInBytes floatValue]/<span class="hljs-number">1024.0</span>f/<span class="hljs-number">1024.0</span>f/<span class="hljs-number">1024.0</span>f;<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"Memory Capacity of %f GB with %f GB Free memory available."</span>, totalSpace, totalFreeSpace);<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"Error Obtaining System Memory Info: Domain = %@, Code = %@"</span>, [error domain], [error code]);<br>    }  <br>}<br></code></pre></div></body></html>